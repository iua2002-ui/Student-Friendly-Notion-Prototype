{"ast":null,"code":"import React, { useEffect, useState, useMemo, useCallback } from 'react';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { ApiService } from '@novu/client';\nimport { NotificationsProvider } from '../../store/notifications-provider.context';\nimport { NovuContext } from '../../store/novu-provider.context';\nimport { NovuI18NProvider } from '../../store/i18n.context';\nimport { StylesProvider } from '../../store/styles';\nimport { applyToken, removeToken } from '../../utils/token';\nimport { useSession } from '../../hooks/useSession';\nimport { useInitializeSocket } from '../../hooks/useInitializeSocket';\nimport { useFetchOrganization, useNovuContext } from '../../hooks';\nimport { SESSION_QUERY_KEY } from '../../hooks/queryKeys';\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      refetchOnMount: false,\n      refetchOnWindowFocus: false\n    }\n  }\n});\nconst DEFAULT_FETCHING_STRATEGY = {\n  fetchUnseenCount: true,\n  fetchOrganization: true,\n  fetchNotifications: false,\n  fetchUserPreferences: false,\n  fetchUserGlobalPreferences: false\n};\nexport function NovuProvider({\n  backendUrl: initialBackendUrl,\n  socketUrl: initialSocketUrl,\n  applicationIdentifier,\n  subscriberId,\n  subscriberHash,\n  stores: initialStores,\n  i18n,\n  styles,\n  initialFetchingStrategy = DEFAULT_FETCHING_STRATEGY,\n  children,\n  onLoad\n}) {\n  const backendUrl = initialBackendUrl !== null && initialBackendUrl !== void 0 ? initialBackendUrl : 'https://api.novu.co';\n  const socketUrl = initialSocketUrl !== null && initialSocketUrl !== void 0 ? initialSocketUrl : 'https://ws.novu.co';\n  const stores = initialStores !== null && initialStores !== void 0 ? initialStores : [{\n    storeId: 'default_store'\n  }];\n  const [fetchingStrategy, setFetchingStrategyState] = useState(Object.assign(Object.assign({}, DEFAULT_FETCHING_STRATEGY), initialFetchingStrategy));\n  const [sessionInfo, setSessionInfo] = useState({\n    isSessionInitialized: false,\n    applicationIdentifier,\n    subscriberId,\n    subscriberHash\n  });\n  const apiService = useMemo(() => {\n    queryClient.clear();\n    const service = new ApiService(backendUrl);\n    applyToken({\n      apiService: service\n    });\n    return service;\n  }, [backendUrl]);\n  const {\n    socket,\n    initializeSocket,\n    disconnectSocket\n  } = useInitializeSocket({\n    socketUrl\n  });\n  const onSuccessfulSession = useCallback(newSession => {\n    applyToken({\n      apiService,\n      token: newSession.token\n    });\n    initializeSocket(newSession);\n    setSessionInfo(old => Object.assign(Object.assign({}, old), {\n      isSessionInitialized: true\n    }));\n  }, [apiService, setSessionInfo, initializeSocket]);\n  const setFetchingStrategy = useCallback(strategy => setFetchingStrategyState(old => Object.assign(Object.assign({}, old), strategy)), [setFetchingStrategyState]);\n  const logout = useCallback(() => {\n    removeToken(apiService);\n    disconnectSocket();\n    setSessionInfo(old => Object.assign(Object.assign({}, old), {\n      isSessionInitialized: false\n    }));\n  }, [setSessionInfo, disconnectSocket, apiService]);\n  const contextValue = useMemo(() => ({\n    backendUrl,\n    socketUrl,\n    applicationIdentifier: sessionInfo.applicationIdentifier,\n    subscriberId: sessionInfo.subscriberId,\n    subscriberHash: sessionInfo.subscriberHash,\n    isSessionInitialized: sessionInfo.isSessionInitialized,\n    apiService,\n    socket,\n    fetchingStrategy,\n    setFetchingStrategy,\n    onLoad,\n    logout\n  }), [backendUrl, socketUrl, sessionInfo, apiService, socket, fetchingStrategy, setFetchingStrategy, onLoad, logout]);\n  useEffect(() => disconnectSocket, [disconnectSocket]);\n  useEffect(() => {\n    setSessionInfo(old => Object.assign(Object.assign({}, old), {\n      isSessionInitialized: false,\n      applicationIdentifier,\n      subscriberId,\n      subscriberHash\n    }));\n    logout();\n    queryClient.refetchQueries([...SESSION_QUERY_KEY, applicationIdentifier, subscriberId, subscriberHash]);\n  }, [logout, subscriberId, applicationIdentifier, subscriberHash]);\n  return React.createElement(QueryClientProvider, {\n    client: queryClient\n  }, React.createElement(NovuContext.Provider, {\n    value: contextValue\n  }, React.createElement(SessionInitializer, {\n    onSuccess: onSuccessfulSession\n  }, React.createElement(NotificationsProvider, {\n    stores: stores\n  }, React.createElement(NovuI18NProvider, {\n    i18n: i18n\n  }, React.createElement(StylesProvider, {\n    styles: styles\n  }, children))))));\n}\nconst SessionInitializer = ({\n  children,\n  onSuccess\n}) => {\n  const {\n    onLoad\n  } = useNovuContext();\n  useSession({\n    onSuccess\n  });\n  useFetchOrganization({\n    onSuccess: organization => {\n      onLoad === null || onLoad === void 0 ? void 0 : onLoad({\n        organization\n      });\n    }\n  });\n  useEffect(() => {\n    if ('parentIFrame' in window) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      window.parentIFrame.autoResize(true);\n    }\n  }, []);\n  return children;\n};","map":{"version":3,"names":["React","useEffect","useState","useMemo","useCallback","QueryClient","QueryClientProvider","ApiService","NotificationsProvider","NovuContext","NovuI18NProvider","StylesProvider","applyToken","removeToken","useSession","useInitializeSocket","useFetchOrganization","useNovuContext","SESSION_QUERY_KEY","queryClient","defaultOptions","queries","refetchOnMount","refetchOnWindowFocus","DEFAULT_FETCHING_STRATEGY","fetchUnseenCount","fetchOrganization","fetchNotifications","fetchUserPreferences","fetchUserGlobalPreferences","NovuProvider","backendUrl","initialBackendUrl","socketUrl","initialSocketUrl","applicationIdentifier","subscriberId","subscriberHash","stores","initialStores","i18n","styles","initialFetchingStrategy","children","onLoad","storeId","fetchingStrategy","setFetchingStrategyState","Object","assign","sessionInfo","setSessionInfo","isSessionInitialized","apiService","clear","service","socket","initializeSocket","disconnectSocket","onSuccessfulSession","newSession","token","old","setFetchingStrategy","strategy","logout","contextValue","refetchQueries","createElement","client","Provider","value","SessionInitializer","onSuccess","organization","window","parentIFrame","autoResize"],"sources":["../../../../src/components/novu-provider/NovuProvider.tsx"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}